syntax = "proto3";
package control;

import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "metrics.proto";

// === Core Service ===
service ControlService {
  rpc OpenNet(OpenNetRequest) returns (OpenNetResponse);
  rpc FlushKeys(FlushKeyRequest) returns (FlushKeyResponse);
  rpc DumpConnections(DumpConnectionRequest) returns (DumpConnectionResponse);
}

// === Open to network ===
message OpenNetRequest {
  string password = 1;
  google.protobuf.Duration key_expiration = 2;
  optional google.protobuf.Duration net_expiration = 3; // How long should the daemon be open to the network
}
message OpenNetResponse {
  bool success = 1;
}

// === Flush Keys ===
message FlushKeyRequest {
  optional google.protobuf.Timestamp older_than = 1;
  optional google.protobuf.Timestamp newer_than = 2;
}
message FlushKeyResponse {
  bool success = 1;
}

// === Connection Dumping ===
message DumpConnectionRequest {}
message DumpConnectionResponse {
  repeated ConnectionDump connection_dumps = 1;
}
message ConnectionDump {
  google.protobuf.Timestamp connection_begin = 1;
  string connection_address = 2;
  google.protobuf.Duration report_interval = 3;
  google.protobuf.Timestamp last_successful_publish = 4;
  string connection_uuid = 5;
}
