/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */

syntax = "proto3";
package service.v1;

import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
import "metrics/v1/metrics.proto";

service Monitord {
  rpc Report(stream ReportRequest) returns (stream ReportResponse);
}

message ReportRequest {
  oneof payload {
    ConnectionRequest request = 1;
    ClientAck ack = 2;
  }
}

message ConnectionRequest {
  google.protobuf.Duration interval = 1;
  bool cpu_per_core = 2;
  bool gpu_processes = 3;
  repeated ProcessFilter process_filters = 4;
}

message ProcessFilter {
  oneof filter {
    string by_user = 1;
    PidRange by_pid = 2;
    string by_name_regex = 3;
    uint32 by_status = 4;
  }
}

message PidRange {
  uint32 lower_inclusive = 1;
  uint32 higher_exclusive = 2;
}

message ClientAck {
  bool processed = 1;
}

message ReportResponse {
  google.protobuf.Timestamp timestamp = 1;
  metrics.v1.Report report = 2;
}
