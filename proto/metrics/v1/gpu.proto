/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */

syntax = "proto3";
package metrics.v1.gpu;

// Represents a snapshot of system GPUs
message Snapshot {
  repeated Gpu gpus = 1;
}

// Represents a single physical GPU
message Gpu {
  // The GPU's branding name (i.e. NVIDIA RTX 4090)
  string brand_name = 1;
  // The name and version of the kernel level driver
  string kernel_driver = 2;
  // The name and version of the userspace OpenGL driver
  string opengl_driver = 3;
  // The name and version of the userspace Vulkan driver
  string vulkan_driver = 4;

  // Utilization of the graphics engine
  double graphics_utilization = 5;
  // The clock of the graphics engine
  uint32 graphics_clock = 6;

  // The total amount of VRAM on the GPU
  uint64 memory_capacity = 7;
  // The amount of VRAM currently in use
  uint64 memory_usage = 8;
  // The clock of the VRAM
  uint32 memory_clock = 9;

  // NOTE ABOUT VIDEO ENCODE/DECODE:
  // AMD reports clock of encode and decode engines separately and utilization is merged
  // NVIDIA reports utilization of encode and decode engines separately and clock is merged

  // Utilization of the video encode engine (if supported)
  double encoder_utilization = 10;
  // Utilization of the video decode engine (if supported)
  double decoder_utilization = 11;
  // The clock of the video encode engine(s) (if supported)
  uint32 encoder_clock = 12;
  // The clock of the video decode engine(s) (if supported)
  uint32 decoder_clock = 13;

  // Power and temperatures
  uint32 power_milliwatt = 14;
  // Temperature of the GPU in degrees Celsius
  int32 temperature = 15;

  // Process information
  repeated Process processes = 16;
}
message Process {
  // Process ID
  uint32 pid = 1;
  // Total graphics utilization
  double graphics_utilization = 2;
  // VRAM allocated to the process
  uint64 memory_usage = 3;
  // Total video encode utilization (if supported)
  double encode_utilization = 4;
  // Total video decode utilization (if supported)
  double decode_utilization = 5;
}
