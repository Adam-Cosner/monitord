/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */

syntax = "proto3";
package metrics.cpu;

// Represents a single snapshot of the CPU(s) of the system
message Snapshot {
    // A flat list of the operating system's logical CPUs
    repeated Logical logical_cpus = 1;
    // The physical topology of the CPU(s) of the system
    repeated Package sockets = 2;
}

// The operating system's logical CPUs
message Logical {
    uint32 os_cpu_id = 1;
    float utilization = 2;
    uint32 cur_freq_mhz = 3;
}

// A physical CPU package
message Package {
    uint32 package_id = 1;

    // Global hardware identification
    string vendor_id = 2;
    string model_name = 3;
    uint32 family = 4;
    uint32 model = 5;
    uint32 stepping = 6;

    string microcode_version = 7;
    string cpufreq_driver = 8;
    string cpufreq_governor = 9;

    float package_temperature_c = 10;
    float package_power_w = 11;

    repeated Cluster clusters = 12;
}

// A physical CPU cluster/die (CCDs on AMD)
message Cluster {
    uint32 cluster_id = 1;
    float cluster_temperature_c = 2;

    repeated CorePhysical cores = 3;
    repeated Cache shared_caches = 4;
}

// A physical CPU core
message CorePhysical {
    uint32 core_id = 1;
    uint32 base_freq_mhz = 2;
    uint32 max_freq_mhz = 3;

    repeated CoreLogical logical_cores = 4;
    repeated Cache private_caches = 5;
}

// A logical CPU core
message CoreLogical {
    uint32 os_cpu_id = 1;
    uint32 core_index = 2;
}

// CPU cache
message Cache {
    enum CacheType {
        UNKNOWN = 0;
        INSTRUCTION = 1;
        DATA = 2;
        UNIFIED = 3;
    }

    uint32 level = 1;
    CacheType cache_type = 2;
    uint32 size_kb = 3;
    uint32 line_size_bytes = 4;
    uint32 associativity = 5;
}
