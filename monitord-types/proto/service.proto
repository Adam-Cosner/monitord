syntax = "proto3";
package monitord;

service Service {
    rpc GetMetrics(GetMetricsRequest) returns (GetMetricsResponse);
}

message GetMetricsRequest {
    optional CpuRequest cpu = 1;
    optional MemoryRequest memory = 2;
    bool disk = 3;
    bool network = 4;
    optional GpuRequest gpu = 5;
    repeated ProcessFilter process = 6;
}

message CpuRequest {
    bool per_core = 1; // whether to include per-core stats
}
message MemoryRequest {
    bool swap = 1;
}
message GpuRequest {
    bool process_data = 1;
}

// range of processes [lower, higher)
message ProcessRange {
    uint32 lower = 1;
    uint32 higher = 2;
}

message ProcessStatus {
    enum ProcessStatusKnown {
        Idle = 0;
        Run = 1;
        Sleep = 2;
        Stop = 3;
        Zombie = 4;
        Tracing = 5;
        Dead = 6;
        WakeKill = 7;
        Waking = 8;
        Parked = 9;
        LockBlocked = 10;
        UninterruptibleDiskSleep = 11;
    }
    oneof status {
        ProcessStatusKnown known = 1;
        uint32 unknown = 2;
    }
}

message ProcessFilter {
    oneof filter {
        string user = 1;
        ProcessRange range = 2;
        string regex = 3;
        ProcessStatus status = 4;
    }

}

message GetMetricsResponse {
    repeated CpuResponse cpu = 1;
    optional MemoryResponse memory = 2;
    repeated GpuResponse gpu = 3;
    repeated DiskResponse disk = 4;
    repeated NetworkResponse network = 5;
    map<uint32, ProcessResponse> process = 6;
}

message CpuResponse {
    string brand = 1; // CPU's brand name (i.e. AMD Ryzen 9 5950X etc.)
    double utilization = 2;
    uint32 frequency_mhz = 3;
    double temperature = 4;
    repeated Core cores = 5;
}

message Core {
    double utilization = 1;
    uint32 frequency_mhz = 2;
}

message MemoryResponse {
    uint64 capacity = 1;
    uint64 in_use = 2;
    uint64 sw_capacity = 3;
    uint64 sw_use = 4;
}

message GpuResponse {
    string brand = 1;
    double utilization = 2;
    double vram_utilization = 3;
    double wattage = 4;
    double fan_speed = 5;
    double temperature = 6;
}

message DiskResponse {
    string name = 1;
    uint64 capacity = 2;
    uint64 total_read = 3;
    uint64 reading = 4;
    uint64 total_write = 5;
    uint64 writing = 6;
}

message NetworkResponse {
    string name = 1;
    uint64 received = 2;
    uint64 receiving = 3;
    uint64 sent = 4;
    uint64 sending = 5;
    string ipv4_address = 6;
    double signal_strength = 7;
}

message ProcessResponse {
    string name = 1;
    string user = 2;
    uint32 pid = 3;
    double cpu = 4;
    uint64 memory = 5;
    double gpu = 6;
    uint64 disk_read = 7;
    uint64 disk_write = 8;
    int32 priority = 9;
    ProcessStatus status = 10;
}
